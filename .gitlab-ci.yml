stages:
    - debug-build
    - release-build

openSuse development build:
    stage: debug-build
    image: dnegi/asta-astaprint-build:leap-latest
    script:
        - cargo build
    artifacts:
        paths:
            - target/debug/backend
            - target/debug/worker
            - target/debug/dispater
    only:
        - debug
        - web

Debian development build:
    stage: debug-build
    image: dnegi/asta-astaprint-build:buster-latest
    script:
        - cargo build 
    artifacts:
        paths:
            - target/debug/backend
            - target/debug/worker
            - target/debug/dispatcher
    only:
        - debug
        - web

openSuse release build:
    stage: release-build
    image: dnegi/asta-astaprint-build:leap-latest
    script:
        - cargo build --release
    artifacts:
        paths:
            - target/release/backend
            - target/release/worker
            - target/release/dispatcher
        expire_in: 2d
    only:
        - release
        - web

Debian release build:
    stage: release-build
    image: dnegi/asta-astaprint-build:buster-latest
    script:
        - cargo build --release
    artifacts:
        paths:
            - target/release/backend
            - target/release/worker
            - target/release/dispatcher
        expire_in: 2d
    only:
        - release
        - web
